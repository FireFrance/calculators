<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>FireFrance calculators</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="FireFrance calculators">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
</head>
<body>
  <div class="card">
    <div class="card-body">
    <header>
      <h1>PEA comparison simulator</h1>
    </header>

    <p>
      This calculator will simulate the accumulation of savings in a PEA over time, based on a starting amount and a fixed monthly contribution.
      When the PEA's limit of 150,000 euros is hit, contributions will automatically be stopped as close to the max as possible, and the funds will
      continue to grow from then until the end of the period. It will then provide an estimated income you can draw from the PEA based on prefered
      safe withdrawal rate. 
    </p>
    
    <p>
      All calculations are based on current estimates of the fees of each provider, which can be complex and could change, but we did our best to take
      everything into account correctly.
      See <a href="https://fireuktofrance.wordpress.com/2020/11/29/investing-from-france-best-pea-for-fire/" target="new">our blog post on PEAs for more details</a>
    </p>
    <p>
      The calculator provides a comparison between the best PEA products I found. First, the monthly contribution you input has the brokerage fees
      for each bank subtracted from it. These fees differ depending on the amount you put in. After this a future value function is used to compound
      based on the monthly fraction of the expected growth rate. Once the chosen period of saving is over, we calculate an estimated monthly income using the 
      specified withdrawal rate, subtracting the brokerage fees again to sell the shares and deducting taxes. This assumes that the withdrawals don't reduce
      the capital in the account, and that you have waited at least 5 years for PEAs before withdrawing.

      The code is all open source and MIT licensed, so feel free to check it out and clone/fork it you want to change stuff.
    </p>
    <p>
      All calculators are performed in your browser and no data that you input is sent to any server
    </p>

    <div class="card">
      <div class="card-body">
        <div class="row">
          <div class="col-sm">
            <h3>Simulation options</h2>
            <form id="accumlation">
              <div class="form-group">
                <label for="growthRatePercent">Expected yearly growth in percent.</label>
                <input type="number" class="form-control" name="growthRatePercent" value=7>
              </div>
              <div class="form-group">
                  <label for="numberOfYears">Number of years to accummulate</label>
                  <input type="number" class="form-control" name="numberOfYears" value=15>
              </div>
              <div class="form-group">
                  <label for="startingValue">Initial value</label>
                  <input type="number" class="form-control" name="startingValue" value=0>
              </div>
              <div class="form-group">
                  <label for="monthlyContribution">Monthly contribution</label>
                  <input type="number" class="form-control" name="monthlyContribution" value=833>
              </div>
              <div class="form-group">
                <label for="expenseRatio">Avg expense ratio of funds in account in percent. Amundi MSCI World is 0.38%</label>
                <input type="number" class="form-control" name="expenseRatio" value=0.38>
              </div>
              <div class="form-group">
                <label for="limit">Limit - after which contributions will be stopped</label>
                <input type="number" class="form-control" name="limit" value=150000>
              </div>
              <div class="form-group">
                <label for="withdrawalRatePercent">Withdrawal Rate Percentage - 4% is optimistic, 3% more conservative</label>
                <input type="number" class="form-control" name="withdrawalRatePercent" value=4>
              </div>
              <button type="button" class="btn btn-primary" onclick="submitAccumulation()">Submit</button>
            </form>
          </div>
          <div class="col-sm">
            <h3>Accumulation by year</h2>
              <p>This shows how much would be in each account at the year-end</p>
            <div id="accumlation-table"></div>
            <h3>Withdrawal estimate</h3>
            <p>How much you could withdraw per month after taxes. Disclaimer: this is an estimate for comparison purposes!</p>
            <div id="withdrawal-table"></div>
          </div>
        </div> 
      </div>
    </div>
  </div>
</div>

    
  <script src="comparison.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.css" rel="stylesheet">
  <script type="text/javascript">

    let accumulationTable = null
    let withdrawalTable = null

    const providers = [
        { 
            name:'Bourse Direct',
            calcBrokerFee: bouseDirectPeaBrokerageFee,
            calcWithdrawalFee: () => 6,
            portfolio: [
                { name: 'MSCI World', expenseRatio: 0.38, percentage: 100 }
            ]
        },
        {
            name: 'Boursorama',
            calcBrokerFee: boursoramaPeaBrokerageFee,
            calcWithdrawalFee: () => 0,
            portfolio: [
                { name: 'MSCI World', expenseRatio: 0.38, percentage: 100 }
            ]
        },
        {
            name: 'Saxo',
            calcBrokerFee: saxoBankPeaBrokerageFee,
            calcWithdrawalFee: () => 0,
            portfolio: [
                { name: 'MSCI World', expenseRatio: 0.38, percentage: 100 }
            ]
        }
    ]

    function formFieldsToObject() {
      const formData = $("#accumlation").serializeArray()

      const parameters = formData.reduce((acc, cur) => (
          {
            ...acc,
            [cur.name]: cur.value
          }
      ), {})

      return parameters
    }

    function getAccumulationData() {
      const parameters = formFieldsToObject()
      const graphData = getAccumlationGraphData(parameters, providers)
      return graphData
    }

    function getWithdrawalData() {
      const parameters = formFieldsToObject()
      const widthdrawalData = getWithdrawalAmounts(parameters, providers)
      return widthdrawalData
    }

    function submitAccumulation() {
      const graphData = getAccumulationData()
      if (accumulationTable) {
        const [, ...rest] = graphData
        accumulationTable.loadData(rest)
      }

      const widthdrawalData = getWithdrawalData()
      if (withdrawalTable) {
        const [, ...rest] = widthdrawalData
        withdrawalTable.loadData(rest)
      }
    }

    const currencyColumn = {
      type: 'numeric',
      numericFormat: {
        pattern: '0,0.00',
        culture: 'fr-FR'
      }
    }

    $(document).ready(function() {
      const accumlationData = getAccumulationData()
      const [accumulationHeader, ...accumulationRows] = accumlationData

      const columns = [
        { type: 'numeric' },
        ...accumulationHeader.slice(0, -1).map(header => currencyColumn)
      ]

      const accumulationContainer = document.getElementById('accumlation-table');
      accumulationTable = new Handsontable(accumulationContainer, {
        data: accumulationRows,
        rowHeaders: false,
        colHeaders: accumulationHeader,
        licenseKey: 'non-commercial-and-evaluation',
        columns
      });

      const withdrawalData = getWithdrawalData()
      const [withdrawalHeader, ...withdrawalRows] = withdrawalData

      const withDrawalColumns = [
        { type: 'text' },
        ...withdrawalHeader.slice(0, -1).map(header => currencyColumn)
      ]

      const withdrawalContainer = document.getElementById('withdrawal-table');
      withdrawalTable = new Handsontable(withdrawalContainer, {
        data: withdrawalRows,
        rowHeaders: false,
        colHeaders: withdrawalHeader,
        licenseKey: 'non-commercial-and-evaluation',
        columns: withDrawalColumns,
      });
    })
  </script>
</body>
</html>